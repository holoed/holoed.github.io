<!doctype html>
  <html>
    <head>
      <meta http-equiv="Cache-control" content="no-cache">
      <link rel="stylesheet" href="javascripts/xterm/dist/xterm.css" />
      <script src="javascripts/xterm/dist/xterm.js"></script>
      <script src="javascripts/systemjs/dist/system.js"></script>
    </head>
    <body style="background-color:black; color:yellow;">
      <pre>
         __            _
        / /_  ______  (_)___  _____
   __  / / / / / __ \/ / __ \/ ___/
  / /_/ / /_/ / / / / / /_/ / /
  \____/\__,_/_/ /_/_/\____/_/
      </pre>
      <div id="terminal"></div>
      <script>
       SystemJS.import('./javascripts/CodeV4/Externals.js').then(function (ext) {
       SystemJS.import('./javascripts/CodeV4/Base.js').then(function (base) {
       SystemJS.import('./javascripts/CodeV4/Parser.js').then(function (parser) {
       SystemJS.import('./javascripts/CodeV4/CodeGenerator.js').then(function (codegen) {

       var { cons, isEmpty, head, tail, empty, fst, snd, mkTuple2 } = ext;
       var { compose, foldLeft, foldRight, range, concat, append, fmap } = base;

       String.prototype.replaceAt=function(index, replacement) {
           return this.substr(0, index) + replacement+ this.substr(index + replacement.length);
        }

       var term = new Terminal({
          cursorBlink: true,  // Do not blink the terminal's cursor
          cols: 120,  // Set the terminal's width to 120 columns
          rows: 80  // Set the terminal's height to 80 rows
          });
        term.open(document.getElementById('terminal'));

        var shellprompt = 'junior> ';

        term.prompt = function () {
          term.write(shellprompt);
        };

        term.prompt();
        term.on('key', function (key, ev) {
            var printable = (
              !ev.altKey && !ev.altGraphKey && !ev.ctrlKey && !ev.metaKey
            );
            if (ev.keyCode == 13) {
              term.write('')
              var currentCommand = term.children[term.buffer.y].innerText;
              var progAst = (ext.fst ((ext.head (((parser.parse (parser.progP)) ((ext.stringToCharList (currentCommand))))))));
              var js = codegen.toJs(progAst)
              var ret = eval("(function(){ " + js + " })()");
              term.writeln("\r\n" + ret.toString())
              term.prompt();
            } else if (ev.keyCode == 8) {
             // Do not delete the prompt
              if (term.buffer.x > shellprompt.length) {
                term.write('\b \b');
                currentCommand = term.children[term.buffer.y - 1].innerText;
              }
            } else if (ev.keyCode == 38) {
              currentCommand = term.children[term.buffer.y - 1].innerText;
              term.write(currentCommand);
            } else if (ev.code == "ArrowDown" || ev.code == "ArrowUp") {
              console.log("not supported")
            }else if (printable) {
              term.write(key);
            }
          });
        });
      });
    });
  });
      </script>
    </body>
  </html>
